<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Affymetrix Fusion SDK: C:/FusionSDK/affy/sdk/util/BaseEngine.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.2 -->
<div class="tabs">
  <ul>
    <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="namespaces.html"><span>Namespaces</span></a></li>
    <li><a href="annotated.html"><span>Classes</span></a></li>
    <li class="current"><a href="files.html"><span>Files</span></a></li>
    <li><a href="dirs.html"><span>Directories</span></a></li>
    <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
  </ul>
</div>
<div class="tabs">
  <ul>
    <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
  </ul>
</div>
<div class="nav">
<a class="el" href="dir_0083bb8eedef7fed63dbf70caf86d00a.html">FusionSDK</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_e86b6dbad4e625ef3fbba6406e2d4163.html">affy</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_f87490fa8939fe2ce5b8b80cbaa3c2fa.html">sdk</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_374f7a135d973daad145d25feb2e5488.html">util</a></div>
<h1>BaseEngine.cpp</h1><a href="_base_engine_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 
<a name="l00002"></a>00002 <span class="comment">//</span>
<a name="l00003"></a>00003 <span class="comment">// Copyright (C) 2005 Affymetrix, Inc.</span>
<a name="l00004"></a>00004 <span class="comment">//</span>
<a name="l00005"></a>00005 <span class="comment">// This program is free software; you can redistribute it and/or modify </span>
<a name="l00006"></a>00006 <span class="comment">// it under the terms of the GNU General Public License (version 2) as </span>
<a name="l00007"></a>00007 <span class="comment">// published by the Free Software Foundation.</span>
<a name="l00008"></a>00008 <span class="comment">// </span>
<a name="l00009"></a>00009 <span class="comment">// This program is distributed in the hope that it will be useful, </span>
<a name="l00010"></a>00010 <span class="comment">// but WITHOUT ANY WARRANTY; without even the implied warranty of </span>
<a name="l00011"></a>00011 <span class="comment">// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU </span>
<a name="l00012"></a>00012 <span class="comment">// General Public License for more details.</span>
<a name="l00013"></a>00013 <span class="comment">// </span>
<a name="l00014"></a>00014 <span class="comment">// You should have received a copy of the GNU General Public License </span>
<a name="l00015"></a>00015 <span class="comment">// along with this program;if not, write to the </span>
<a name="l00016"></a>00016 <span class="comment">// </span>
<a name="l00017"></a>00017 <span class="comment">// Free Software Foundation, Inc., </span>
<a name="l00018"></a>00018 <span class="comment">// 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA</span>
<a name="l00019"></a>00019 <span class="comment">//</span>
<a name="l00021"></a>00021 <span class="comment"></span>
<a name="l00022"></a>00022 <span class="preprocessor">#include "<a class="code" href="_base_engine_8h.html" title="base engine base class">util/BaseEngine.h</a>"</span>
<a name="l00023"></a>00023 <span class="comment">//</span>
<a name="l00024"></a>00024 <span class="preprocessor">#include "<a class="code" href="_affx_conv_8h.html" title="This header contains some data conversion routines.">util/AffxConv.h</a>"</span>
<a name="l00025"></a>00025 <span class="comment">//</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include "<a class="code" href="_string_utils_8h.html">calvin_files/utils/src/StringUtils.h</a>"</span>
<a name="l00027"></a>00027 <span class="comment">//</span>
<a name="l00028"></a>00028 
<a name="l00029"></a>00029 <span class="comment">/*</span>
<a name="l00030"></a>00030 <span class="comment"> * The head of the engine data objects.</span>
<a name="l00031"></a>00031 <span class="comment"> */</span>
<a name="l00032"></a>00032 <a class="code" href="class_engine_reg.html">EngineReg</a> *<a class="code" href="class_engine_reg.html#87279eafe2bfeb71ac6731eb550c8795">EngineReg::m_Head</a> = NULL;
<a name="l00033"></a>00033 
<a name="l00034"></a>00034 <span class="comment">/*</span>
<a name="l00035"></a>00035 <span class="comment"> * Set the members. The head is the pointer to this class.</span>
<a name="l00036"></a>00036 <span class="comment"> */</span>
<a name="l00037"></a><a class="code" href="class_engine_reg.html#95529f83a7564f01958277a00104f704">00037</a> <a class="code" href="class_engine_reg.html#95529f83a7564f01958277a00104f704">EngineReg::EngineReg</a>(<span class="keyword">const</span> std::string &amp;engName) : m_Next(m_Head)
<a name="l00038"></a>00038 {
<a name="l00039"></a>00039     <a class="code" href="class_engine_reg.html#61b9030d31c317b1b23f570a62fdc862">name</a> = engName;
<a name="l00040"></a>00040     <a class="code" href="class_engine_reg.html#87279eafe2bfeb71ac6731eb550c8795">m_Head</a> = <span class="keyword">this</span>;
<a name="l00041"></a>00041 }
<a name="l00042"></a>00042 
<a name="l00043"></a>00043 <span class="comment">/*</span>
<a name="l00044"></a>00044 <span class="comment"> * Destroy the class.</span>
<a name="l00045"></a>00045 <span class="comment"> */</span>
<a name="l00046"></a><a class="code" href="class_engine_reg.html#2b2353606a60327833e83b0c3ff8dcbd">00046</a> <a class="code" href="class_engine_reg.html#2b2353606a60327833e83b0c3ff8dcbd">EngineReg::~EngineReg</a>()
<a name="l00047"></a>00047 {
<a name="l00048"></a>00048 }
<a name="l00049"></a>00049 
<a name="l00050"></a>00050 <span class="comment">/*</span>
<a name="l00051"></a>00051 <span class="comment"> * Create an engine based on the name.</span>
<a name="l00052"></a>00052 <span class="comment"> */</span>
<a name="l00053"></a><a class="code" href="class_engine_reg.html#45ccb694e6daa408fbee75fcd77ced96">00053</a> <a class="code" href="class_base_engine.html" title="Base class for analysis engines.">BaseEngine</a> *<a class="code" href="class_engine_reg.html#45ccb694e6daa408fbee75fcd77ced96">EngineReg::CreateEngine</a>(<span class="keyword">const</span> std::string &amp;<a class="code" href="class_engine_reg.html#61b9030d31c317b1b23f570a62fdc862">name</a>)
<a name="l00054"></a>00054 {
<a name="l00055"></a>00055     <span class="comment">// Find the matching engine data object.</span>
<a name="l00056"></a>00056     <span class="keywordflow">for</span> (<a class="code" href="class_engine_reg.html">EngineReg</a> *p=<a class="code" href="class_engine_reg.html#87279eafe2bfeb71ac6731eb550c8795">m_Head</a>; p != NULL; p = p-&gt;<a class="code" href="class_engine_reg.html#3397102668a44bd59def08358a219809">m_Next</a>)
<a name="l00057"></a>00057     {
<a name="l00058"></a>00058         <span class="keywordflow">if</span> (p-&gt;name == name)
<a name="l00059"></a>00059         {
<a name="l00060"></a>00060             <a class="code" href="class_base_engine.html" title="Base class for analysis engines.">BaseEngine</a> *engine = p-&gt;MakeObject();
<a name="l00061"></a>00061             <span class="keywordflow">if</span> (engine)
<a name="l00062"></a>00062             {
<a name="l00063"></a>00063                 <span class="keywordflow">return</span> engine;
<a name="l00064"></a>00064             }
<a name="l00065"></a>00065         }
<a name="l00066"></a>00066     }
<a name="l00067"></a>00067     <span class="keywordflow">return</span> NULL;
<a name="l00068"></a>00068 }
<a name="l00069"></a>00069 
<a name="l00070"></a>00070 <span class="comment">/*</span>
<a name="l00071"></a>00071 <span class="comment"> * Gets the list of all registered engines.</span>
<a name="l00072"></a>00072 <span class="comment"> */</span>
<a name="l00073"></a><a class="code" href="class_engine_reg.html#c18d6f699c35d729444e39598d439438">00073</a> std::list&lt;std::string&gt; <a class="code" href="class_engine_reg.html#c18d6f699c35d729444e39598d439438">EngineReg::GetEngineNames</a>()
<a name="l00074"></a>00074 {
<a name="l00075"></a>00075     std::list&lt;std::string&gt; names;
<a name="l00076"></a>00076     <span class="keywordflow">for</span> (<a class="code" href="class_engine_reg.html">EngineReg</a> *p=<a class="code" href="class_engine_reg.html#87279eafe2bfeb71ac6731eb550c8795">m_Head</a>; p != NULL; p = p-&gt;<a class="code" href="class_engine_reg.html#3397102668a44bd59def08358a219809">m_Next</a>)
<a name="l00077"></a>00077     {
<a name="l00078"></a>00078         names.push_back(p-&gt;name);
<a name="l00079"></a>00079     }
<a name="l00080"></a>00080     <span class="keywordflow">return</span> names;
<a name="l00081"></a>00081 }
<a name="l00082"></a>00082 
<a name="l00083"></a>00083 
<a name="l00084"></a><a class="code" href="class_base_engine.html#2bb933797f6ce2ed31fddfca1f8a6099">00084</a> <a class="code" href="class_base_engine.html#2bb933797f6ce2ed31fddfca1f8a6099">BaseEngine::BaseEngine</a>() : m_OptionsChecked(false), m_DiskChecked(false), m_created_new_tempdir(false) {
<a name="l00085"></a>00085 
<a name="l00086"></a>00086     <a class="code" href="class_base_engine.html#9174e2bb4c6cbe095a0e7e10f90a577e">defineOptions</a>();
<a name="l00087"></a>00087 
<a name="l00088"></a>00088     <span class="comment">/* Track our memory usage */</span>
<a name="l00089"></a>00089     uint64_t freeRam = 0, totalRam = 0, swapAvail = 0, memAvail = 0;
<a name="l00090"></a>00090     <a class="code" href="class_util.html#bd09dcbcbe5d0dc6714bf008005fe0b7">Util::memInfo</a>(freeRam, totalRam, swapAvail, memAvail, <span class="keyword">false</span>);
<a name="l00091"></a>00091     <a class="code" href="class_options.html#af215b45e7097fcedae68c15073eb0f8">setOpt</a>(<span class="stringliteral">"free-mem-at-start"</span>,<a class="code" href="_convert_8h.html#9e68e488e4da0371aea30596313537df">ToStr</a>(memAvail));
<a name="l00092"></a>00092     <a class="code" href="class_verbose.html#c4034f68f4c8d2b49cd6340984b940ce" title="Print a message to the stream.">Verbose::out</a>(3,<span class="stringliteral">"In Base Engine Constructor"</span>);
<a name="l00093"></a>00093 }
<a name="l00094"></a>00094 
<a name="l00095"></a><a class="code" href="class_base_engine.html#fac452bb05f7fbd9681fc28871d80742">00095</a> <a class="code" href="class_base_engine.html#2bb933797f6ce2ed31fddfca1f8a6099">BaseEngine::BaseEngine</a>( <span class="keywordtype">char</span> * argv[] ) : <a class="code" href="class_base_engine.html#af6f731e3a54788d3dc8db6009666669">m_OptionsChecked</a>(false), <a class="code" href="class_base_engine.html#68cfe2b603ce4c2df3edceb23cbc761f">m_DiskChecked</a>(false), <a class="code" href="class_base_engine.html#169b1b3d45aa0da1b4b48e4f3d70eab8">m_created_new_tempdir</a>(false) {
<a name="l00096"></a>00096     <a class="code" href="class_options.html#5e8051ed752abcc6046240b484626211">Options::parseArgv</a>( argv );
<a name="l00097"></a>00097 }
<a name="l00098"></a>00098 
<a name="l00099"></a><a class="code" href="class_base_engine.html#c5d21b338977f1b2eb1a123c6612a9cd">00099</a> <a class="code" href="class_base_engine.html#c5d21b338977f1b2eb1a123c6612a9cd">BaseEngine::~BaseEngine</a>() {
<a name="l00100"></a>00100     <a class="code" href="class_verbose.html#c4034f68f4c8d2b49cd6340984b940ce" title="Print a message to the stream.">Verbose::out</a>(3,<span class="stringliteral">"In Base Engine Destructor"</span>);
<a name="l00101"></a>00101 }
<a name="l00102"></a>00102  
<a name="l00103"></a><a class="code" href="class_base_engine.html#c847526947cb75a11370aed195705031">00103</a> std::string <a class="code" href="class_base_engine.html#c847526947cb75a11370aed195705031">BaseEngine::getProgName</a>() { 
<a name="l00104"></a>00104     <span class="keywordflow">return</span> <a class="code" href="class_options.html#c670bfe60cd5ebad21116f7d5cc85718">Options::getProgName</a>(); 
<a name="l00105"></a>00105 }
<a name="l00106"></a>00106 
<a name="l00107"></a><a class="code" href="class_base_engine.html#90a5cba41ed5a3fe1b2fb9dc2896c696">00107</a> <span class="keywordtype">void</span> <a class="code" href="class_base_engine.html#90a5cba41ed5a3fe1b2fb9dc2896c696">BaseEngine::setLibFileOpt</a>(<span class="keyword">const</span> std::string &amp;option) {
<a name="l00108"></a>00108     <a class="code" href="class_options.html#af215b45e7097fcedae68c15073eb0f8">setOpt</a>(option,<a class="code" href="class_util.html#5b31bc660526f70d6a20a94a0cc37caf">Util::findLibFile</a>(<a class="code" href="class_options.html#0efc7e2a4a55297f0f642d1d8bc08b82">getOpt</a>(option), <a class="code" href="class_options.html#0efc7e2a4a55297f0f642d1d8bc08b82">getOpt</a>(<span class="stringliteral">"analysis-files-path"</span>)));
<a name="l00109"></a>00109 }
<a name="l00110"></a>00110 
<a name="l00111"></a><a class="code" href="class_base_engine.html#2d72424f85cd48253aa9cdc60ea83ef5">00111</a> <span class="keywordtype">void</span> <a class="code" href="class_base_engine.html#2d72424f85cd48253aa9cdc60ea83ef5">BaseEngine::checkOptions</a>() {
<a name="l00112"></a>00112 
<a name="l00113"></a>00113     <span class="keywordflow">if</span>(<a class="code" href="class_base_engine.html#af6f731e3a54788d3dc8db6009666669">m_OptionsChecked</a>)
<a name="l00114"></a>00114         <span class="keywordflow">return</span>;
<a name="l00115"></a>00115 
<a name="l00116"></a>00116     <span class="comment">// Note what options we started with</span>
<a name="l00117"></a>00117     <a class="code" href="class_options.html#e6d1e9fb84ce4eefa51f133551c0e6db">snapshotOptions</a>(<span class="stringliteral">"initial"</span>);
<a name="l00118"></a>00118 
<a name="l00119"></a>00119     <span class="comment">// Define additional state values -- those configured by base engine</span>
<a name="l00120"></a>00120     <span class="comment">// The children will cal their defineStates() in checkOptionsImp()</span>
<a name="l00121"></a>00121     <a class="code" href="class_base_engine.html#02d40b1ceb8b8ab0c18075ba1e383053">BaseEngine::defineStates</a>();
<a name="l00122"></a>00122 
<a name="l00123"></a>00123     <span class="keywordflow">if</span>(<a class="code" href="class_options.html#3c98038375042f9b230b3e4e2151fe00">getOptBool</a>(<span class="stringliteral">"throw-exception"</span>)) { 
<a name="l00124"></a>00124         <a class="code" href="class_err.html#ceb62780521f07880083c5bed5c64d13">Err::setThrowStatus</a>(<span class="keyword">true</span>); 
<a name="l00125"></a>00125     }
<a name="l00126"></a>00126 
<a name="l00127"></a>00127     <span class="comment">// does the user want the version </span>
<a name="l00128"></a>00128     <span class="keywordflow">if</span>(<a class="code" href="class_options.html#3c98038375042f9b230b3e4e2151fe00">getOptBool</a>(<span class="stringliteral">"version"</span>)) {
<a name="l00129"></a>00129         std::cout &lt;&lt; <span class="stringliteral">"version: "</span> &lt;&lt; <a class="code" href="class_options.html#0efc7e2a4a55297f0f642d1d8bc08b82">getOpt</a>(<span class="stringliteral">"version-to-report"</span>) &lt;&lt; std::endl;
<a name="l00130"></a>00130         exit(0);
<a name="l00131"></a>00131     }
<a name="l00132"></a>00132     <span class="comment">// Do we need help? (I know I do...)</span>
<a name="l00133"></a>00133     <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="class_options.html#3c98038375042f9b230b3e4e2151fe00">getOptBool</a>(<span class="stringliteral">"help"</span>)) {
<a name="l00134"></a>00134         std::set&lt;std::string&gt; toHide;
<a name="l00135"></a>00135         <a class="code" href="class_options.html#9c058f7b6c500c2cf55986e03f91a2af">optionUsage</a>(toHide, <span class="keyword">true</span>);
<a name="l00136"></a>00136 
<a name="l00137"></a>00137         <a class="code" href="class_base_engine.html#1a7f5f9707a9040698a2375cd6a2630c">extraHelp</a>();
<a name="l00138"></a>00138 
<a name="l00139"></a>00139         std::cout &lt;&lt; <span class="stringliteral">"version: "</span> &lt;&lt; <a class="code" href="class_options.html#0efc7e2a4a55297f0f642d1d8bc08b82">getOpt</a>(<span class="stringliteral">"version-to-report"</span>) &lt;&lt; std::endl;
<a name="l00140"></a>00140         exit(0);
<a name="l00141"></a>00141     }
<a name="l00142"></a>00142 
<a name="l00143"></a>00143     <a class="code" href="class_base_engine.html#ab071e91259acc39461b21a79e18b450">checkOptionsImp</a>();
<a name="l00144"></a>00144 
<a name="l00145"></a>00145     <a class="code" href="class_base_engine.html#af6f731e3a54788d3dc8db6009666669">m_OptionsChecked</a> = <span class="keyword">true</span>;
<a name="l00146"></a>00146 
<a name="l00147"></a>00147     <span class="keywordflow">if</span>(<a class="code" href="class_options.html#3c98038375042f9b230b3e4e2151fe00">getOptBool</a>(<span class="stringliteral">"throw-exception"</span>)) { 
<a name="l00148"></a>00148         <a class="code" href="class_err_handler.html">ErrHandler</a> *handler = <a class="code" href="class_err.html#7cd8651ed7e53ac86b43dad235d1cb91">Err::popHandler</a>();
<a name="l00149"></a>00149         <a class="code" href="_util_8h.html#d0787eda9709999bbd42dc11b21deb0d">Freez</a>(handler);
<a name="l00150"></a>00150     }
<a name="l00151"></a>00151 }
<a name="l00152"></a>00152 
<a name="l00153"></a><a class="code" href="class_base_engine.html#26f15eb0f4a36ea9a75f32ecc6b2e504">00153</a> <span class="keywordtype">void</span> <a class="code" href="class_base_engine.html#26f15eb0f4a36ea9a75f32ecc6b2e504">BaseEngine::checkDiskSpace</a>() {
<a name="l00154"></a>00154 
<a name="l00155"></a>00155     <a class="code" href="class_base_engine.html#2d72424f85cd48253aa9cdc60ea83ef5">checkOptions</a>();
<a name="l00156"></a>00156     <span class="keywordflow">if</span>(<a class="code" href="class_base_engine.html#68cfe2b603ce4c2df3edceb23cbc761f">m_DiskChecked</a>) 
<a name="l00157"></a>00157         <span class="keywordflow">return</span>;
<a name="l00158"></a>00158 
<a name="l00159"></a>00159     <span class="keywordflow">if</span>(<a class="code" href="class_options.html#3c98038375042f9b230b3e4e2151fe00">getOptBool</a>(<span class="stringliteral">"throw-exception"</span>)) { 
<a name="l00160"></a>00160         <a class="code" href="class_err.html#ceb62780521f07880083c5bed5c64d13">Err::setThrowStatus</a>(<span class="keyword">true</span>); 
<a name="l00161"></a>00161     }
<a name="l00162"></a>00162 
<a name="l00163"></a>00163     <a class="code" href="class_base_engine.html#c6559f09928954e162a974ebd061597a">checkDiskSpaceImp</a>();
<a name="l00164"></a>00164 
<a name="l00165"></a>00165     <a class="code" href="class_base_engine.html#68cfe2b603ce4c2df3edceb23cbc761f">m_DiskChecked</a> = <span class="keyword">true</span>;
<a name="l00166"></a>00166 
<a name="l00167"></a>00167     <span class="keywordflow">if</span>(<a class="code" href="class_options.html#3c98038375042f9b230b3e4e2151fe00">getOptBool</a>(<span class="stringliteral">"throw-exception"</span>)) { 
<a name="l00168"></a>00168         <a class="code" href="class_err_handler.html">ErrHandler</a> *handler = <a class="code" href="class_err.html#7cd8651ed7e53ac86b43dad235d1cb91">Err::popHandler</a>();
<a name="l00169"></a>00169         <a class="code" href="_util_8h.html#d0787eda9709999bbd42dc11b21deb0d">Freez</a>(handler);
<a name="l00170"></a>00170     }
<a name="l00171"></a>00171 }
<a name="l00172"></a>00172 
<a name="l00173"></a>00173 
<a name="l00178"></a><a class="code" href="class_base_engine.html#a6314624576726733233a660d2ab93db">00178</a> <span class="keywordtype">void</span> <a class="code" href="class_base_engine.html#a6314624576726733233a660d2ab93db" title="Top level function to open up files and make sure things look ok then start analysis...">BaseEngine::run</a>() {
<a name="l00179"></a>00179 
<a name="l00180"></a>00180   <span class="keywordflow">if</span>(<a class="code" href="class_options.html#3c98038375042f9b230b3e4e2151fe00">getOptBool</a>(<span class="stringliteral">"throw-exception"</span>)) { 
<a name="l00181"></a>00181       <a class="code" href="class_err.html#ceb62780521f07880083c5bed5c64d13">Err::setThrowStatus</a>(<span class="keyword">true</span>); 
<a name="l00182"></a>00182   }
<a name="l00183"></a>00183 
<a name="l00184"></a>00184   <a class="code" href="class_verbose.html#c4034f68f4c8d2b49cd6340984b940ce" title="Print a message to the stream.">Verbose::out</a>(1, <span class="stringliteral">"Running "</span> + <a class="code" href="class_base_engine.html#c80a847c6cd6cb56ad9454bbdfe6d61f">getEngineName</a>() + <span class="stringliteral">"..."</span>);
<a name="l00185"></a>00185   <a class="code" href="class_base_engine.html#acc8ff918a9d586418b71ede389837e2">printEngineOptions</a>(<span class="stringliteral">"Initial "</span>);
<a name="l00186"></a>00186 
<a name="l00187"></a>00187   <span class="comment">/* Check our options */</span>
<a name="l00188"></a>00188   <a class="code" href="class_base_engine.html#2d72424f85cd48253aa9cdc60ea83ef5">checkOptions</a>();
<a name="l00189"></a>00189   <a class="code" href="class_base_engine.html#26f15eb0f4a36ea9a75f32ecc6b2e504">checkDiskSpace</a>();
<a name="l00190"></a>00190 
<a name="l00191"></a>00191   <span class="comment">/* Set some initial state info */</span>
<a name="l00192"></a>00192   <a class="code" href="class_options.html#af215b45e7097fcedae68c15073eb0f8">setOpt</a>(<span class="stringliteral">"time-start"</span>,<a class="code" href="class_util.html#ccf4f30492f3726aac3197a37b3f77cc">Util::getTimeStamp</a>());
<a name="l00193"></a>00193   time_t startTime = time(NULL);
<a name="l00194"></a>00194 
<a name="l00195"></a>00195   <span class="comment">/* Do the analysis requested. */</span>
<a name="l00196"></a>00196   <a class="code" href="class_verbose.html#c4034f68f4c8d2b49cd6340984b940ce" title="Print a message to the stream.">Verbose::out</a>(3,<span class="stringliteral">"Base Engine Before runImp()"</span>);
<a name="l00197"></a>00197   <a class="code" href="class_util.html#0babcf1f4d1afa0fc46975782b0bda94">Util::pushMemFreeAtStart</a>();
<a name="l00198"></a>00198   <a class="code" href="class_base_engine.html#9d77cb9b5c81fe684cd8fb688768a8f9">runImp</a>();
<a name="l00199"></a>00199   <a class="code" href="class_util.html#9acb101ef69d9b05f53f6eb7f411ab14">Util::popMemFreeAtStart</a>();
<a name="l00200"></a>00200   <a class="code" href="class_verbose.html#c4034f68f4c8d2b49cd6340984b940ce" title="Print a message to the stream.">Verbose::out</a>(3,<span class="stringliteral">"Base Engine After runImp()"</span>);
<a name="l00201"></a>00201 
<a name="l00202"></a>00202   <a class="code" href="class_options.html#af215b45e7097fcedae68c15073eb0f8">setOpt</a>(<span class="stringliteral">"time-end"</span>,<a class="code" href="class_util.html#ccf4f30492f3726aac3197a37b3f77cc">Util::getTimeStamp</a>());
<a name="l00203"></a>00203   time_t endTime = time(NULL);
<a name="l00204"></a>00204   <span class="keywordtype">int</span> t = int(  (<span class="keywordtype">float</span>)(endTime - startTime) / 60.0 * 100); <span class="comment">// convert to minutes</span>
<a name="l00205"></a>00205   <a class="code" href="class_options.html#af215b45e7097fcedae68c15073eb0f8">setOpt</a>(<span class="stringliteral">"time-run-minutes"</span>,<a class="code" href="_convert_8h.html#9e68e488e4da0371aea30596313537df">ToStr</a>((<span class="keywordtype">float</span>)t/100));
<a name="l00206"></a>00206   <a class="code" href="class_verbose.html#c4034f68f4c8d2b49cd6340984b940ce" title="Print a message to the stream.">Verbose::out</a>(1, <a class="code" href="_convert_8h.html#9e68e488e4da0371aea30596313537df">ToStr</a>(<span class="stringliteral">"Run took approximately: "</span>) + <a class="code" href="_convert_8h.html#9e68e488e4da0371aea30596313537df">ToStr</a>((<span class="keywordtype">float</span>)t/100) + <a class="code" href="_convert_8h.html#9e68e488e4da0371aea30596313537df">ToStr</a>(((<span class="keywordtype">float</span>)t/100) &gt; 1 ? <span class="stringliteral">" minutes."</span> : <span class="stringliteral">" minute."</span>));
<a name="l00207"></a>00207 
<a name="l00208"></a>00208   <a class="code" href="class_base_engine.html#acc8ff918a9d586418b71ede389837e2">printEngineOptions</a>(<span class="stringliteral">"Final "</span>);
<a name="l00209"></a>00209   <a class="code" href="class_verbose.html#c4034f68f4c8d2b49cd6340984b940ce" title="Print a message to the stream.">Verbose::out</a>(1, <span class="stringliteral">"Done running "</span> + <a class="code" href="class_base_engine.html#c80a847c6cd6cb56ad9454bbdfe6d61f">getEngineName</a>() + <span class="stringliteral">"."</span>);
<a name="l00210"></a>00210 
<a name="l00211"></a>00211   <span class="keywordflow">if</span>(<a class="code" href="class_options.html#3c98038375042f9b230b3e4e2151fe00">getOptBool</a>(<span class="stringliteral">"throw-exception"</span>)) { 
<a name="l00212"></a>00212       <a class="code" href="class_err_handler.html">ErrHandler</a> *handler = <a class="code" href="class_err.html#7cd8651ed7e53ac86b43dad235d1cb91">Err::popHandler</a>();
<a name="l00213"></a>00213       <a class="code" href="_util_8h.html#d0787eda9709999bbd42dc11b21deb0d">Freez</a>(handler);
<a name="l00214"></a>00214   }
<a name="l00215"></a>00215 } 
<a name="l00216"></a>00216 
<a name="l00217"></a><a class="code" href="class_base_engine.html#9174e2bb4c6cbe095a0e7e10f90a577e">00217</a> <span class="keywordtype">void</span> <a class="code" href="class_base_engine.html#9174e2bb4c6cbe095a0e7e10f90a577e">BaseEngine::defineOptions</a>() {
<a name="l00218"></a>00218   <a class="code" href="class_options.html#8b0b17c7744ee0b5103434064781808d">defineOptionSection</a>(<span class="stringliteral">"Common Options (not used by all programs)"</span>);
<a name="l00219"></a>00219   <a class="code" href="class_options.html#601b17850308799889a9e4fcfbe16d18">defineOption</a>(<span class="stringliteral">"h"</span>, <span class="stringliteral">"help"</span>, <a class="code" href="class_pg_opt.html#bd900ee9ae406b602233b8769e333f9fc5d23985e141fdd0d1387be91543c7d5">PgOpt::BOOL_OPT</a>,
<a name="l00220"></a>00220                      <span class="stringliteral">"Display program options and extra documentation about possible analyses. "</span>
<a name="l00221"></a>00221                      <span class="stringliteral">"See -explain for information about a specific operation."</span>,
<a name="l00222"></a>00222                      <span class="stringliteral">"false"</span>);
<a name="l00223"></a>00223   <a class="code" href="class_options.html#601b17850308799889a9e4fcfbe16d18">defineOption</a>(<span class="stringliteral">"v"</span>, <span class="stringliteral">"verbose"</span>, <a class="code" href="class_pg_opt.html#bd900ee9ae406b602233b8769e333f9ffbe709e3e0616b413d7ff9e15091f322">PgOpt::INT_OPT</a>,
<a name="l00224"></a>00224                      <span class="stringliteral">"How verbose to be with status messages 0 - quiet, 1 - usual messages, 2 - more messages."</span>,
<a name="l00225"></a>00225                      <span class="stringliteral">"1"</span>);
<a name="l00226"></a>00226   <a class="code" href="class_options.html#601b17850308799889a9e4fcfbe16d18">defineOption</a>(<span class="stringliteral">""</span>, <span class="stringliteral">"version"</span>, <a class="code" href="class_pg_opt.html#bd900ee9ae406b602233b8769e333f9fc5d23985e141fdd0d1387be91543c7d5">PgOpt::BOOL_OPT</a>,
<a name="l00227"></a>00227                      <span class="stringliteral">"Display version information."</span>,
<a name="l00228"></a>00228                      <span class="stringliteral">"false"</span>);
<a name="l00229"></a>00229   <a class="code" href="class_options.html#601b17850308799889a9e4fcfbe16d18">defineOption</a>(<span class="stringliteral">"f"</span>, <span class="stringliteral">"force"</span>, <a class="code" href="class_pg_opt.html#bd900ee9ae406b602233b8769e333f9fc5d23985e141fdd0d1387be91543c7d5">PgOpt::BOOL_OPT</a>,
<a name="l00230"></a>00230                      <span class="stringliteral">"Disable various checks including chip types. Consider using --chip-type option rather than --force."</span>,
<a name="l00231"></a>00231                      <span class="stringliteral">"false"</span>);
<a name="l00232"></a>00232   <a class="code" href="class_options.html#601b17850308799889a9e4fcfbe16d18">defineOption</a>(<span class="stringliteral">""</span>, <span class="stringliteral">"throw-exception"</span>, <a class="code" href="class_pg_opt.html#bd900ee9ae406b602233b8769e333f9fc5d23985e141fdd0d1387be91543c7d5">PgOpt::BOOL_OPT</a>,
<a name="l00233"></a>00233                      <span class="stringliteral">"Throw an exception rather than calling exit() on error. Useful for debugging. This option is intended for command line use only. If you are wrapping an Engine and want exceptions thrown, then you should call Err::setThrowStatus(true) to ensure that all Err::errAbort() calls result in an exception."</span>,
<a name="l00234"></a>00234                      <span class="stringliteral">"false"</span>);
<a name="l00235"></a>00235   <a class="code" href="class_options.html#601b17850308799889a9e4fcfbe16d18">defineOption</a>(<span class="stringliteral">""</span>, <span class="stringliteral">"analysis-files-path"</span>, <a class="code" href="class_pg_opt.html#bd900ee9ae406b602233b8769e333f9f1b7a64f1a2a78b752b5d19644bc56186">PgOpt::STRING_OPT</a>, 
<a name="l00236"></a>00236                      <span class="stringliteral">"Search path for analysis library files. Will override AFFX_ANALYSIS_FILES_PATH environment variable."</span>, 
<a name="l00237"></a>00237                      <span class="stringliteral">""</span>);
<a name="l00238"></a>00238   <a class="code" href="class_options.html#601b17850308799889a9e4fcfbe16d18">defineOption</a>(<span class="stringliteral">""</span>, <span class="stringliteral">"xml-file"</span>, <a class="code" href="class_pg_opt.html#bd900ee9ae406b602233b8769e333f9f1b7a64f1a2a78b752b5d19644bc56186">PgOpt::STRING_OPT</a>, 
<a name="l00239"></a>00239                      <span class="stringliteral">"Input parameters in XML format (Will override command line settings)."</span>, 
<a name="l00240"></a>00240                      <span class="stringliteral">""</span>);
<a name="l00241"></a>00241   <a class="code" href="class_options.html#601b17850308799889a9e4fcfbe16d18">defineOption</a>(<span class="stringliteral">""</span>,<span class="stringliteral">"temp-dir"</span>, <a class="code" href="class_pg_opt.html#bd900ee9ae406b602233b8769e333f9f1b7a64f1a2a78b752b5d19644bc56186">PgOpt::STRING_OPT</a>,
<a name="l00242"></a>00242                      <span class="stringliteral">"Directory for temporary files when working off disk. Using network mounted drives is not advised. When not set, the output folder will be used. The defaut is typically the output directory or the current working directory."</span>,
<a name="l00243"></a>00243                      <span class="stringliteral">""</span>);
<a name="l00244"></a>00244   <a class="code" href="class_options.html#601b17850308799889a9e4fcfbe16d18">defineOption</a>(<span class="stringliteral">"o"</span>,<span class="stringliteral">"out-dir"</span>, <a class="code" href="class_pg_opt.html#bd900ee9ae406b602233b8769e333f9f1b7a64f1a2a78b752b5d19644bc56186">PgOpt::STRING_OPT</a>,
<a name="l00245"></a>00245                      <span class="stringliteral">"Directory for output files. Defaults to current working directory."</span>,
<a name="l00246"></a>00246                      <span class="stringliteral">"."</span>);
<a name="l00247"></a>00247   <a class="code" href="class_options.html#601b17850308799889a9e4fcfbe16d18">defineOption</a>(<span class="stringliteral">""</span>,<span class="stringliteral">"log-file"</span>, <a class="code" href="class_pg_opt.html#bd900ee9ae406b602233b8769e333f9f1b7a64f1a2a78b752b5d19644bc56186">PgOpt::STRING_OPT</a>,
<a name="l00248"></a>00248                      <span class="stringliteral">"The name of the log file. Generally defaults to the program name in the out-dir folder."</span>,
<a name="l00249"></a>00249                      <span class="stringliteral">""</span>);
<a name="l00250"></a>00250 
<a name="l00251"></a>00251   <a class="code" href="class_options.html#8b0b17c7744ee0b5103434064781808d">defineOptionSection</a>(<span class="stringliteral">"Engine Options (Not used on command line)"</span>);
<a name="l00252"></a>00252   <a class="code" href="class_options.html#601b17850308799889a9e4fcfbe16d18">defineOption</a>(<span class="stringliteral">""</span>,<span class="stringliteral">"command-line"</span>, <a class="code" href="class_pg_opt.html#bd900ee9ae406b602233b8769e333f9f1b7a64f1a2a78b752b5d19644bc56186">PgOpt::STRING_OPT</a>,
<a name="l00253"></a>00253                      <span class="stringliteral">"The command line executed."</span>,
<a name="l00254"></a>00254                      <span class="stringliteral">""</span>);
<a name="l00255"></a>00255   <a class="code" href="class_options.html#601b17850308799889a9e4fcfbe16d18">defineOption</a>(<span class="stringliteral">""</span>,<span class="stringliteral">"exec-guid"</span>, <a class="code" href="class_pg_opt.html#bd900ee9ae406b602233b8769e333f9f1b7a64f1a2a78b752b5d19644bc56186">PgOpt::STRING_OPT</a>,
<a name="l00256"></a>00256                      <span class="stringliteral">"The GUID for the process."</span>,
<a name="l00257"></a>00257                      <span class="stringliteral">""</span>);
<a name="l00258"></a>00258   <a class="code" href="class_options.html#601b17850308799889a9e4fcfbe16d18">defineOption</a>(<span class="stringliteral">""</span>,<span class="stringliteral">"program-name"</span>, <a class="code" href="class_pg_opt.html#bd900ee9ae406b602233b8769e333f9f1b7a64f1a2a78b752b5d19644bc56186">PgOpt::STRING_OPT</a>,
<a name="l00259"></a>00259                      <span class="stringliteral">"The name of the program"</span>,
<a name="l00260"></a>00260                      <span class="stringliteral">""</span>);
<a name="l00261"></a>00261   <a class="code" href="class_options.html#601b17850308799889a9e4fcfbe16d18">defineOption</a>(<span class="stringliteral">""</span>,<span class="stringliteral">"program-company"</span>, <a class="code" href="class_pg_opt.html#bd900ee9ae406b602233b8769e333f9f1b7a64f1a2a78b752b5d19644bc56186">PgOpt::STRING_OPT</a>,
<a name="l00262"></a>00262                      <span class="stringliteral">"The company providing the program"</span>,
<a name="l00263"></a>00263                      <span class="stringliteral">""</span>);
<a name="l00264"></a>00264   <a class="code" href="class_options.html#601b17850308799889a9e4fcfbe16d18">defineOption</a>(<span class="stringliteral">""</span>,<span class="stringliteral">"program-version"</span>, <a class="code" href="class_pg_opt.html#bd900ee9ae406b602233b8769e333f9f1b7a64f1a2a78b752b5d19644bc56186">PgOpt::STRING_OPT</a>,
<a name="l00265"></a>00265                      <span class="stringliteral">"The version of the program"</span>,
<a name="l00266"></a>00266                      <span class="stringliteral">""</span>);
<a name="l00267"></a>00267   <a class="code" href="class_options.html#601b17850308799889a9e4fcfbe16d18">defineOption</a>(<span class="stringliteral">""</span>,<span class="stringliteral">"program-cvs-id"</span>, <a class="code" href="class_pg_opt.html#bd900ee9ae406b602233b8769e333f9f1b7a64f1a2a78b752b5d19644bc56186">PgOpt::STRING_OPT</a>,
<a name="l00268"></a>00268                      <span class="stringliteral">"The CVS version of the program"</span>,
<a name="l00269"></a>00269                      <span class="stringliteral">""</span>);
<a name="l00270"></a>00270   <a class="code" href="class_options.html#601b17850308799889a9e4fcfbe16d18">defineOption</a>(<span class="stringliteral">""</span>,<span class="stringliteral">"version-to-report"</span>, <a class="code" href="class_pg_opt.html#bd900ee9ae406b602233b8769e333f9f1b7a64f1a2a78b752b5d19644bc56186">PgOpt::STRING_OPT</a>,
<a name="l00271"></a>00271                      <span class="stringliteral">"The version to report in the output files."</span>,
<a name="l00272"></a>00272                      <span class="stringliteral">""</span>);
<a name="l00273"></a>00273   <a class="code" href="class_options.html#601b17850308799889a9e4fcfbe16d18">defineOption</a>(<span class="stringliteral">""</span>, <span class="stringliteral">"free-mem-at-start"</span>, <a class="code" href="class_pg_opt.html#bd900ee9ae406b602233b8769e333f9f1b7a64f1a2a78b752b5d19644bc56186">PgOpt::STRING_OPT</a>,
<a name="l00274"></a>00274                      <span class="stringliteral">"How much physical memory was available when the engine run started."</span>,
<a name="l00275"></a>00275                      <span class="stringliteral">"0"</span>);
<a name="l00276"></a>00276 }
<a name="l00277"></a>00277 
<a name="l00278"></a><a class="code" href="class_base_engine.html#02d40b1ceb8b8ab0c18075ba1e383053">00278</a> <span class="keywordtype">void</span> <a class="code" href="class_base_engine.html#02d40b1ceb8b8ab0c18075ba1e383053">BaseEngine::defineStates</a>() {
<a name="l00279"></a>00279   <a class="code" href="class_options.html#601b17850308799889a9e4fcfbe16d18">defineOption</a>(<span class="stringliteral">""</span>, <span class="stringliteral">"time-start"</span>, <a class="code" href="class_pg_opt.html#bd900ee9ae406b602233b8769e333f9f1b7a64f1a2a78b752b5d19644bc56186">PgOpt::STRING_OPT</a>,
<a name="l00280"></a>00280                      <span class="stringliteral">"The time the engine run was started"</span>,
<a name="l00281"></a>00281                      <span class="stringliteral">""</span>);
<a name="l00282"></a>00282   <a class="code" href="class_options.html#601b17850308799889a9e4fcfbe16d18">defineOption</a>(<span class="stringliteral">""</span>, <span class="stringliteral">"time-end"</span>, <a class="code" href="class_pg_opt.html#bd900ee9ae406b602233b8769e333f9f1b7a64f1a2a78b752b5d19644bc56186">PgOpt::STRING_OPT</a>,
<a name="l00283"></a>00283                      <span class="stringliteral">"The time the engine run ended"</span>,
<a name="l00284"></a>00284                      <span class="stringliteral">""</span>);
<a name="l00285"></a>00285   <a class="code" href="class_options.html#601b17850308799889a9e4fcfbe16d18">defineOption</a>(<span class="stringliteral">""</span>, <span class="stringliteral">"time-run-minutes"</span>, <a class="code" href="class_pg_opt.html#bd900ee9ae406b602233b8769e333f9f1b7a64f1a2a78b752b5d19644bc56186">PgOpt::STRING_OPT</a>,
<a name="l00286"></a>00286                      <span class="stringliteral">"The run time in minutes."</span>,
<a name="l00287"></a>00287                      <span class="stringliteral">""</span>);
<a name="l00288"></a>00288   <a class="code" href="class_options.html#601b17850308799889a9e4fcfbe16d18">defineOption</a>(<span class="stringliteral">""</span>,<span class="stringliteral">"analysis-guid"</span>, <a class="code" href="class_pg_opt.html#bd900ee9ae406b602233b8769e333f9f1b7a64f1a2a78b752b5d19644bc56186">PgOpt::STRING_OPT</a>,
<a name="l00289"></a>00289                      <span class="stringliteral">"The GUID for the analysis run."</span>,
<a name="l00290"></a>00290                      <span class="stringliteral">""</span>);
<a name="l00291"></a>00291 }
<a name="l00292"></a>00292 
<a name="l00293"></a>00293 
<a name="l00294"></a><a class="code" href="class_base_engine.html#edb04274f9439dd9f7797409921c7cf7">00294</a> <span class="keywordtype">void</span> <a class="code" href="class_base_engine.html#edb04274f9439dd9f7797409921c7cf7">BaseEngine::makeTempDir</a>(std::string temp_dir) {
<a name="l00295"></a>00295   <span class="keywordflow">if</span> (!<a class="code" href="class_util.html#ddb931b560006fa7b41d1b5641e78908" title="return true if directory exists and is readable, false otherwise">Util::directoryWritable</a>(temp_dir)) {
<a name="l00296"></a>00296     <span class="comment">// Util::makeDir returns true if "temp-dir" is created, or false if</span>
<a name="l00297"></a>00297     <span class="comment">// "temp-dir" already existed.  otherwise, fatal error</span>
<a name="l00298"></a>00298     <a class="code" href="class_base_engine.html#169b1b3d45aa0da1b4b48e4f3d70eab8">m_created_new_tempdir</a> = <a class="code" href="class_util.html#3b7cf2c4445da53b5498d2510a1174c1">Util::makeDir</a>(temp_dir);
<a name="l00299"></a>00299     <span class="keywordflow">if</span> (!<a class="code" href="class_base_engine.html#169b1b3d45aa0da1b4b48e4f3d70eab8">m_created_new_tempdir</a>) {
<a name="l00300"></a>00300       <a class="code" href="class_err.html#2c92074a0e89f02bba1c217b6c65b000">Err::errAbort</a>(<span class="stringliteral">"Can't make or write to directory: "</span> + temp_dir);
<a name="l00301"></a>00301     }
<a name="l00302"></a>00302   }
<a name="l00303"></a>00303 }
<a name="l00304"></a>00304 
<a name="l00305"></a><a class="code" href="class_base_engine.html#db00d9a481093a9bfc528860d2ae7413">00305</a> <span class="keywordtype">void</span> <a class="code" href="class_base_engine.html#db00d9a481093a9bfc528860d2ae7413">BaseEngine::removeTempDir</a>(std::string temp_dir) {
<a name="l00306"></a>00306   <span class="keywordflow">if</span> (<a class="code" href="class_base_engine.html#169b1b3d45aa0da1b4b48e4f3d70eab8">m_created_new_tempdir</a> &amp;&amp; <a class="code" href="class_util.html#ddb931b560006fa7b41d1b5641e78908" title="return true if directory exists and is readable, false otherwise">Util::directoryWritable</a>(temp_dir)) {
<a name="l00307"></a>00307     <a class="code" href="class_util.html#1f5b895609662fcc7c5663d60853c3fc" title="removes the directory">Util::dirRemove</a>(temp_dir);
<a name="l00308"></a>00308   }
<a name="l00309"></a>00309 }
</pre></div><hr size="1"><address style="text-align: right;"><small>Generated on Fri Oct 16 12:06:17 2009 for Affymetrix Fusion SDK by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.2 </small></address>
</body>
</html>
